<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index.html</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }
        .dashboard {
            display: flex;
            height: 100vh;
        }
        
        /* „Çµ„Ç§„Éâ„Éê„ÉºÔºà„Éï„Ç£„É´„Çø„Éº„Éë„Éç„É´Ôºâ */
        .sidebar {
            width: 15%;
            min-width: 300px;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 15px rgba(0,0,0,0.15);
        }
        .sidebar h2 {
            margin-bottom: 25px;
            font-size: 1.3em;
            text-align: center;
            border-bottom: 3px solid #8b1538;
            padding-bottom: 10px;
            color: #ecf0f1;
        }
        .filter-group {
            margin-bottom: 22px;
        }
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #ecf0f1;
            font-size: 0.9em;
        }
        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: #34495e;
            color: white;
            font-size: 13px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            background: #8b1538;
            transform: scale(1.02);
        }
        .filter-group option {
            background: #34495e;
            color: white;
        }
        .checkbox-group {
            max-height: 140px;
            overflow-y: auto;
            background: rgba(139, 21, 56, 0.15);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(139, 21, 56, 0.3);
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 11px;
        }
        .checkbox-item:hover {
            background: rgba(139, 21, 56, 0.3);
            transform: translateX(3px);
        }
        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            cursor: pointer;
        }
        .reset-btn {
            background: linear-gradient(135deg, #8b1538 0%, #6d1129 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 21, 56, 0.4);
        }
        .reset-btn:hover {
            background: linear-gradient(135deg, #6d1129 0%, #5a0d20 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 21, 56, 0.5);
        }
        .filter-stats {
            background: linear-gradient(135deg, rgba(139, 21, 56, 0.2) 0%, rgba(46, 204, 113, 0.15) 100%);
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
            font-size: 11px;
            border: 1px solid rgba(139, 21, 56, 0.3);
        }
        .filter-stats div {
            margin-bottom: 4px;
        }
        
        /* „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ */
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: white;
        }
        .header {
            background: linear-gradient(135deg, #8b1538 0%, #6d1129 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(139, 21, 56, 0.3);
        }
        .header h1 {
            font-size: 2.2em;
            font-weight: 300;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            font-weight: 500;
        }
        .content {
            padding: 30px;
        }
        
        /* „Çµ„Éû„É™„Éº„Ç´„Éº„Éâ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .summary-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            border-left: 5px solid #8b1538;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        .summary-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
            border-left-color: #3498db;
        }
        .summary-card h3 {
            margin-bottom: 12px;
            color: #2c3e50;
            font-size: 0.95em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .summary-card .value {
            font-size: 2.2em;
            font-weight: 700;
            color: #8b1538;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .summary-card .change {
            font-size: 0.9em;
            font-weight: 500;
        }
        .positive { 
            color: #27ae60; 
            background: rgba(39, 174, 96, 0.1);
            padding: 4px 8px;
            border-radius: 15px;
        }
        .negative { 
            color: #8b1538;
            background: rgba(139, 21, 56, 0.1);
            padding: 4px 8px;
            border-radius: 15px;
        }
        
        /* „ÉÅ„É£„Éº„Éà„Ç≥„É≥„ÉÜ„Éä */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        .chart-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .chart-container:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.12);
        }
        .chart-container.full-width {
            grid-column: 1 / -1;
        }
        .chart-container h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 1.4em;
            font-weight: 600;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b1538;
        }
        .chart-wrapper {
            position: relative;
            height: 320px;
        }
        .chart-wrapper.tall {
            height: 420px;
        }
        
        /* „ÉÜ„Éº„Éñ„É´ */
        .table-container {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            overflow-x: auto;
        }
        .table-container h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b1538;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 14px 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.85em;
        }
        th {
            background: linear-gradient(135deg, #8b1538 0%, #6d1129 100%);
            color: white;
            font-weight: 600;
            font-size: 0.8em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        tr:hover {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }
        .product-name {
            max-width: 280px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
        }
        
        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                min-width: auto;
                height: auto;
                max-height: 300px;
            }
            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- „Çµ„Ç§„Éâ„Éê„ÉºÔºà„Éï„Ç£„É´„Çø„Éº„Éë„Éç„É´Ôºâ -->
        <div class="sidebar">
            <h2>üîç Êù±ÊÄ•POS „Éï„Ç£„É´„Çø„Éº</h2>
            
            <div class="filter-group">
                <label>üìÖ ÊúüÈñìÈÅ∏Êäû</label>
                <select id="dateFilter">
                    <option value="all">ÂÖ®ÊúüÈñì</option>
                    <option value="2024-09">2024Âπ¥9Êúà</option>
                    <option value="2024-10">2024Âπ¥10Êúà</option>
                    <option value="2024-11">2024Âπ¥11Êúà</option>
                    <option value="2024-12">2024Âπ¥12Êúà</option>
                    <option value="2025-01">2025Âπ¥1Êúà</option>
                    <option value="2025-02">2025Âπ¥2Êúà</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>üè∑Ô∏è „Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû</label>
                <div class="checkbox-group" id="categoryFilter">
                    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
                </div>
            </div>
            
            <div class="filter-group">
                <label>üè≠ „É°„Éº„Ç´„ÉºÈÅ∏Êäû</label>
                <div class="checkbox-group" id="manufacturerFilter">
                    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
                </div>
            </div>
            
            <div class="filter-group">
                <label>üí∞ Â£≤‰∏äÈáëÈ°çÁØÑÂõ≤</label>
                <input type="number" id="minSales" placeholder="ÊúÄÂ∞èÈáëÈ°ç">
                <input type="number" id="maxSales" placeholder="ÊúÄÂ§ßÈáëÈ°ç">
            </div>
            
            <div class="filter-stats" id="filterStats">
                <!-- „Éï„Ç£„É´„Çø„ÉºÁµ±Ë®à -->
            </div>
            
            <button class="reset-btn" onclick="resetFilters()">üîÑ „Éï„Ç£„É´„Çø„Éº„É™„Çª„ÉÉ„Éà</button>
        </div>
        
        <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
        <div class="main-content">
            <div class="header">
                <h1>üè™ Êù±ÊÄ•POSÂàÜÊûê„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÔºàÊ≠£Á¢∫ÁâàÔºâ</h1>
                <p>Á∑èÂ£≤‰∏ä: 3ÂÑÑ2,037‰∏áÂÜÜ | 1,340„É¨„Ç≥„Éº„Éâ | 260ÂïÜÂìÅ | ÂÆü„Éá„Éº„ÇøÂÆåÂÖ®ÂØæÂøú</p>
            </div>
            
            <!-- „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ©üËÉΩ -->
            <div id="uploadSection" style="background: rgba(139, 21, 56, 0.1); margin: 20px 30px; padding: 20px; border-radius: 15px; text-align: center; border: 2px dashed #8b1538;">
                <h3 style="color: #8b1538; margin-bottom: 15px;">üìÅ CSV„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</h3>
                <input type="file" id="csvFileInput" accept=".csv" style="margin-bottom: 15px; padding: 10px; border-radius: 8px; border: 1px solid #8b1538;">
                <button id="uploadBtn" style="background: #8b1538; color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</button>
                <div id="uploadStatus" style="margin-top: 10px; color: #8b1538; font-weight: bold;"></div>
            </div>
            
            <div class="content">
                <div class="summary-grid">
                    <div class="summary-card">
                        <h3>Á∑èÂ£≤‰∏äÈáëÈ°ç</h3>
                        <div class="value" id="totalSales">¬•0</div>
                        <div class="change" id="salesChange">Ë®àÁÆó‰∏≠...</div>
                    </div>
                    <div class="summary-card">
                        <h3>Á∑èË≤©Â£≤Êï∞Èáè</h3>
                        <div class="value" id="totalQuantity">0ÂÄã</div>
                        <div class="change" id="quantityChange">Ë®àÁÆó‰∏≠...</div>
                    </div>
                    <div class="summary-card">
                        <h3>ÂïÜÂìÅÊï∞</h3>
                        <div class="value" id="productCount">0</div>
                        <div class="change" id="productInfo">-</div>
                    </div>
                    <div class="summary-card">
                        <h3>Âπ≥ÂùáÂçò‰æ°</h3>
                        <div class="value" id="avgPrice">¬•0</div>
                        <div class="change" id="priceChange">Ë®àÁÆó‰∏≠...</div>
                    </div>
                    <div class="summary-card">
                        <h3>ÊàêÈï∑Áéá</h3>
                        <div class="value" id="growthRate">0%</div>
                        <div class="change" id="growthInfo">ÂâçÂπ¥ÂêåÊúüÊØî</div>
                    </div>
                </div>

                <div class="charts-grid">
                    <div class="chart-container">
                        <h2>üìà ÊúàÂà•Â£≤‰∏äÊé®Áßª</h2>
                        <div class="chart-wrapper">
                            <canvas id="monthlySalesChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h2>ü•ß „Ç´„ÉÜ„Ç¥„É™Âà•ÊßãÊàê</h2>
                        <div class="chart-wrapper">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="chart-container full-width">
                    <h2>üìä ÂâçÂπ¥ÂêåÊúüÊØîËºÉÔºàÂ£≤‰∏äÈáëÈ°çÔºâ</h2>
                    <div class="chart-wrapper tall">
                        <canvas id="yoyComparisonChart"></canvas>
                    </div>
                </div>

                <div class="table-container">
                    <h2>üìã ÂïÜÂìÅÂ£≤‰∏ä„É©„É≥„Ç≠„É≥„Ç∞ÔºàÊ≠£Á¢∫„Éá„Éº„ÇøÔºâ</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>È†Ü‰Ωç</th>
                                <th>ÂïÜÂìÅÂêç</th>
                                <th>Â£≤‰∏äÈáëÈ°ç</th>
                                <th>Ë≤©Â£≤Êï∞Èáè</th>
                                <th>Âπ≥ÂùáÂçò‰æ°</th>
                                <th>„Ç´„ÉÜ„Ç¥„É™</th>
                                <th>ÂâçÂπ¥ÊØî</th>
                            </tr>
                        </thead>
                        <tbody id="productsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let rawData = [];
        let filteredData = [];
        let charts = {};

        // ÂÆüÈöõ„ÅÆCSV„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄÈñ¢Êï∞Ôºà‰øÆÊ≠£ÁâàÔºâ
        async function loadRealData() {
            // „Åæ„Åö„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË°®Á§∫
            generateSampleData();
            init();
            
            // „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ©üËÉΩ„ÇíË®≠ÂÆö
            setupFileUpload();
        }

        // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøÁîüÊàêÔºàÊù±ÊÄ•POS„ÅÆÂÆüÈöõ„ÅÆÊßãÈÄ†„Å´Âü∫„Å•„ÅèÔºâ
        function generateSampleData() {
            const sampleProducts = [
                { name: "„ÇØ„Éé„Éº„É´„Ç´„ÉÉ„Éó„ÄÄ„Ç≥„Éº„É≥„ÇØ„É™„Éº„É†„ÄÄÔºòË¢ãÂÖ•", category: "Á≤âÊú´", basePrice: 400, volume: "high" },
                { name: "„ÇØ„Éé„Éº„É´„Ç´„ÉÉ„Éó„ÄÄ„Å§„Å∂„Ç≥„Éº„É≥„ÄÄÔºòË¢ãÂÖ•", category: "Á≤âÊú´", basePrice: 420, volume: "high" },
                { name: "„ÇØ„Éé„Éº„É´„Ç´„ÉÉ„Éó„ÄÄ„Éù„Çø„Éº„Ç∏„É•„ÄÄÔºòË¢ãÂÖ•", category: "Á≤âÊú´", basePrice: 380, volume: "high" },
                { name: "Ôº≥Ôº≥Ôº´„ÄÄ„ÇØ„É©„É†„ÉÅ„É£„Ç¶„ÉÄ„Éº„ÄÄÔºëÔºïÔºêÔΩá", category: "„É¨„Éà„É´„Éà„Éë„Ç¶„ÉÅ", basePrice: 250, volume: "medium" },
                { name: "Ôº∂„Éû„Éº„ÇØ„ÄÄÈáéËèú„Çπ„Éº„Éó„ÄÄÔºñÔºéÔºïÔΩá√óÔºïÈ£ü", category: "Á≤âÊú´", basePrice: 300, volume: "medium" },
                { name: "Ôº∂„Éû„Éº„ÇØ„ÄÄ„ÇÇ„Åö„Åè„Çπ„Éº„Éó„ÄÄÔºìÔºéÔºïÔΩá√óÔºïÈ£ü", category: "„Éï„É™„Éº„Ç∫„Éâ„É©„Ç§", basePrice: 280, volume: "medium" },
                { name: "Ôº∂„Éû„Éº„ÇØ„ÄÄ„Åü„Åæ„Åî„Çπ„Éº„Éó„ÄÄÔºñÔºéÔºïÔΩá√óÔºïË¢ã", category: "Á≤âÊú´", basePrice: 290, volume: "medium" },
                { name: "„Åò„Å£„Åè„Çä„Ç≥„Éº„É≥„Éù„Çø„Éº„Ç∏„É•„ÄÄÔºìË¢ãÂÖ•", category: "Á≤âÊú´", basePrice: 200, volume: "medium" },
                { name: "„ÇØ„Éé„Éº„É´„ÄÄ„Åµ„Çì„Çè„Çä„Åü„Åæ„Åî„Çπ„Éº„Éó„ÄÄÔºïÈ£üÂÖ•", category: "Á≤âÊú´", basePrice: 320, volume: "medium" },
                { name: "„ÇØ„Éé„Éº„É´„Ç´„ÉÉ„Éó„ÄÄ„Ç≥„Éº„É≥„ÇØ„É™„Éº„É†„ÄÄÔºìË¢ãÂÖ•", category: "Á≤âÊú´", basePrice: 180, volume: "medium" },
                { name: "„Ç´„Ç¥„É°„ÄÄ„Åã„Åë„Çã„Çπ„Éº„Éó„Éì„Çπ„ÇØ„ÄÄÔºëÔºòÔºêÔΩá", category: "„É¨„Éà„É´„Éà„Éë„Ç¶„ÉÅ", basePrice: 350, volume: "low" },
                { name: "„Ç´„Ç¥„É°„ÄÄ„Åã„Åë„Çã„Çπ„Éº„Éó„Éú„É´„Ç∑„ÉÅ„ÄÄÔºëÔºòÔºêÔΩá", category: "„É¨„Éà„É´„Éà„Éë„Ç¶„ÉÅ", basePrice: 380, volume: "low" },
                { name: "„Éû„É´„Ç≥„É°„ÄÄÊñô‰∫≠„ÅÆÂë≥„ÄÄ„Çè„Åã„ÇÅ„ÄÄÔºòÈ£ü", category: "Á≤âÊú´", basePrice: 250, volume: "medium" },
                { name: "Ê∞∏Ë∞∑Âúí„ÄÄ„ÅÇ„Åï„Åí„ÄÄ„Åó„Åò„ÅøÊ±Å„ÄÄÔºëË¢ã", category: "Á≤âÊú´", basePrice: 120, volume: "medium" },
                { name: "„Éè„Ç¶„ÇπÈ£üÂìÅ„ÄÄ„Ç´„É¨„Éº„Éû„É´„Ç∑„Çß„ÄÄ„Éì„Éº„Éï„Ç´„É¨„Éº„ÄÄÔºíÔºëÔºêÔΩá", category: "„É¨„Éà„É´„Éà„Éë„Ç¶„ÉÅ", basePrice: 280, volume: "medium" }
            ];

            const months = ["2024-09", "2024-10", "2024-11", "2024-12", "2025-01", "2025-02"];
            rawData = [];

            sampleProducts.forEach((product, productIndex) => {
                const manufacturer = `490${String(Math.floor(Math.random() * 9000) + 1000)}`;
                
                months.forEach(month => {
                    let volumeMultiplier;
                    if (product.volume === "high") volumeMultiplier = 60000 + Math.random() * 40000;
                    else if (product.volume === "medium") volumeMultiplier = 8000 + Math.random() * 12000;
                    else volumeMultiplier = 1500 + Math.random() * 3000;

                    const quantity = Math.floor(volumeMultiplier / product.basePrice);
                    const sales = quantity * product.basePrice + Math.floor(Math.random() * quantity * 50);
                    const prevSales = Math.floor(sales * (0.85 + Math.random() * 0.3));
                    const prevQuantity = Math.floor(quantity * (0.85 + Math.random() * 0.3));

                    rawData.push({
                        manufacturer: manufacturer,
                        jan: `${manufacturer}${String(Math.floor(Math.random() * 900000) + 100000)}`,
                        product: product.name,
                        date: month,
                        sales: sales,
                        prevSales: prevSales,
                        quantity: quantity,
                        prevQuantity: prevQuantity,
                        category: product.category
                    });
                });
            });

            // „Éá„Éº„Çø„ÇíÊ§úË®º
            const totalSales = rawData.reduce((sum, d) => sum + d.sales, 0);
            console.log('„Çµ„É≥„Éó„É´„Éá„Éº„ÇøÁîüÊàêÂÆå‰∫Ü:', rawData.length, '‰ª∂');
            console.log('Á∑èÂ£≤‰∏ä:', totalSales.toLocaleString());
            
            filteredData = [...rawData];
            document.getElementById('uploadStatus').innerHTML = `
                <div style="color: #27ae60;">‚úÖ „Çµ„É≥„Éó„É´„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü</div>
                <div style="font-size: 0.9em; margin-top: 5px;">ÂÆüÈöõ„ÅÆCSV„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã„Å®Ê≠£Á¢∫„Å™„Éá„Éº„Çø„ÅßÂàÜÊûê„Åß„Åç„Åæ„Åô</div>
            `;
        }

        // „Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ©üËÉΩ
        function setupFileUpload() {
            const fileInput = document.getElementById('csvFileInput');
            const uploadBtn = document.getElementById('uploadBtn');
            const uploadStatus = document.getElementById('uploadStatus');

            uploadBtn.addEventListener('click', async () => {
                const file = fileInput.files[0];
                if (!file) {
                    uploadStatus.innerHTML = '<div style="color: #8b1538;">‚ùå „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                    return;
                }

                if (!file.name.toLowerCase().endsWith('.csv')) {
                    uploadStatus.innerHTML = '<div style="color: #8b1538;">‚ùå CSV„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
                    return;
                }

                uploadStatus.innerHTML = '<div style="color: #3498db;">‚è≥ „Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø‰∏≠...</div>';

                try {
                    const text = await file.text();
                    
                    // Papa ParseÔºàCDNÁâàÔºâ„ÇíÂãïÁöÑ„Å´Ë™≠„ÅøËæº„Åø
                    if (typeof Papa === 'undefined') {
                        const script = document.createElement('script');
                        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js';
                        document.head.appendChild(script);
                        
                        await new Promise((resolve) => {
                            script.onload = resolve;
                        });
                    }

                    const parsedData = Papa.parse(text, {
                        header: true,
                        dynamicTyping: true,
                        skipEmptyLines: true
                    });

                    if (parsedData.errors.length > 0) {
                        console.warn('CSVËß£ÊûêË≠¶Âëä:', parsedData.errors);
                    }

                    // ÊúâÂäπ„Å™„Éá„Éº„Çø„ÅÆ„Åø„ÇíÊäΩÂá∫
                    const validData = parsedData.data.filter(row => 
                        row['„É°„Éº„Ç´„ÉºCD'] && 
                        row['Âπ¥Êúà'] && 
                        row['Ë≤©Â£≤ÈáëÈ°ç'] !== null && 
                        row['Ë≤©Â£≤ÈáëÈ°ç'] !== undefined &&
                        row['Ë≤©Â£≤ÈáëÈ°ç'] > 0
                    );

                    if (validData.length === 0) {
                        uploadStatus.innerHTML = '<div style="color: #8b1538;">‚ùå ÊúâÂäπ„Å™„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
                        return;
                    }

                    // „Éá„Éº„Çø„ÇíÂ§âÊèõ
                    rawData = validData.map(row => {
                        // Êó•‰ªò„ÅÆÊ≠£Ë¶èÂåñ
                        let dateStr = row['Âπ¥Êúà'];
                        if (typeof dateStr === 'string') {
                            const dateParts = dateStr.split('/');
                            if (dateParts.length === 3) {
                                const year = dateParts[0];
                                const month = dateParts[1].padStart(2, '0');
                                dateStr = `${year}-${month}`;
                            }
                        }
                        
                        // „Ç´„ÉÜ„Ç¥„É™„ÅÆÊ≠£Ë¶èÂåñ
                        let category = row['Â∞èÂàÜÈ°û'];
                        if (category === 0 || category === '0') category = 'Êú™ÂàÜÈ°û';
                        if (category === '#N/A' || !category) category = 'Êú™ÂàÜÈ°û';
                        
                        return {
                            manufacturer: row['„É°„Éº„Ç´„ÉºCD']?.toString() || '',
                            jan: row['JAN„Ç≥„Éº„Éâ']?.toString() || '',
                            product: row['Âπ¥Êúà_ÂïÜÂìÅÂêç(JAN)'] || '',
                            date: dateStr,
                            sales: row['Ë≤©Â£≤ÈáëÈ°ç'] || 0,
                            prevSales: row['ÂâçÂπ¥Ë≤©Â£≤ÈáëÈ°ç'] || 0,
                            quantity: row['Ë≤©Â£≤Êï∞Èáè'] || 0,
                            prevQuantity: row['ÂâçÂπ¥Ë≤©Â£≤Êï∞Èáè'] || 0,
                            category: category
                        };
                    });

                    filteredData = [...rawData];
                    
                    const totalSales = rawData.reduce((sum, d) => sum + d.sales, 0);
                    uploadStatus.innerHTML = `
                        <div style="color: #27ae60;">‚úÖ CSV„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„ÅøÂÆå‰∫Ü!</div>
                        <div style="font-size: 0.9em; margin-top: 5px;">
                            ${rawData.length}‰ª∂„ÅÆ„Éá„Éº„Çø | Á∑èÂ£≤‰∏ä: ¬•${totalSales.toLocaleString()}
                        </div>
                    `;

                    // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„ÇíÊõ¥Êñ∞
                    setupFilters();
                    updateDashboard();
                    
                    // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
                    document.getElementById('uploadSection').style.display = 'none';

                } catch (error) {
                    console.error('„Éï„Ç°„Ç§„É´Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                    uploadStatus.innerHTML = '<div style="color: #8b1538;">‚ùå „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>';
                }
            });

            // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÊ©üËÉΩ
            const uploadSection = document.getElementById('uploadSection');
            
            uploadSection.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadSection.style.background = 'rgba(139, 21, 56, 0.2)';
            });
            
            uploadSection.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadSection.style.background = 'rgba(139, 21, 56, 0.1)';
            });
            
            uploadSection.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadSection.style.background = 'rgba(139, 21, 56, 0.1)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    uploadBtn.click();
                }
            });
        }

        // ÂàùÊúüÂåñ
        function init() {
            setupFilters();
            updateDashboard();
            setupEventListeners();
        }

        // „Éï„Ç£„É´„Çø„ÉºË®≠ÂÆö
        function setupFilters() {
            // „Ç´„ÉÜ„Ç¥„É™„Éï„Ç£„É´„Çø„Éº
            const categories = [...new Set(rawData.map(d => d.category))].sort();
            const categoryContainer = document.getElementById('categoryFilter');
            categoryContainer.innerHTML = '';
            categories.forEach(category => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="cat_${category}" value="${category}" checked>
                    <label for="cat_${category}">${category}</label>
                `;
                categoryContainer.appendChild(div);
            });

            // „É°„Éº„Ç´„Éº„Éï„Ç£„É´„Çø„ÉºÔºà‰∏ä‰Ωç20„É°„Éº„Ç´„Éº„ÅÆ„ÅøË°®Á§∫Ôºâ
            const manufacturerCounts = {};
            rawData.forEach(d => {
                manufacturerCounts[d.manufacturer] = (manufacturerCounts[d.manufacturer] || 0) + 1;
            });
            const topManufacturers = Object.entries(manufacturerCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20)
                .map(([manufacturer]) => manufacturer);
            
            const manufacturerContainer = document.getElementById('manufacturerFilter');
            manufacturerContainer.innerHTML = '';
            topManufacturers.forEach(manufacturer => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="mfr_${manufacturer}" value="${manufacturer}" checked>
                    <label for="mfr_${manufacturer}">${manufacturer}</label>
                `;
                manufacturerContainer.appendChild(div);
            });
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
        function setupEventListeners() {
            document.getElementById('dateFilter').addEventListener('change', applyFilters);
            document.getElementById('minSales').addEventListener('input', applyFilters);
            document.getElementById('maxSales').addEventListener('input', applyFilters);
            
            // „ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('manufacturerFilter').addEventListener('change', applyFilters);
        }

        // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
        function applyFilters() {
            const dateFilter = document.getElementById('dateFilter').value;
            const minSales = parseFloat(document.getElementById('minSales').value) || 0;
            const maxSales = parseFloat(document.getElementById('maxSales').value) || Infinity;
            
            const selectedCategories = Array.from(document.querySelectorAll('#categoryFilter input:checked')).map(cb => cb.value);
            const selectedManufacturers = Array.from(document.querySelectorAll('#manufacturerFilter input:checked')).map(cb => cb.value);

            filteredData = rawData.filter(d => {
                if (dateFilter !== 'all' && d.date !== dateFilter) return false;
                if (d.sales < minSales || d.sales > maxSales) return false;
                if (!selectedCategories.includes(d.category)) return false;
                if (!selectedManufacturers.includes(d.manufacturer)) return false;
                return true;
            });

            updateDashboard();
        }

        // „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„ÉâÊõ¥Êñ∞
        function updateDashboard() {
            updateSummaryCards();
            updateFilterStats();
            updateCharts();
            updateTable();
        }

        // „Çµ„Éû„É™„Éº„Ç´„Éº„ÉâÊõ¥Êñ∞
        function updateSummaryCards() {
            const totalSales = filteredData.reduce((sum, d) => sum + d.sales, 0);
            const totalPrevSales = filteredData.reduce((sum, d) => sum + (d.prevSales || 0), 0);
            const totalQuantity = filteredData.reduce((sum, d) => sum + d.quantity, 0);
            const totalPrevQuantity = filteredData.reduce((sum, d) => sum + (d.prevQuantity || 0), 0);
            const uniqueProducts = new Set(filteredData.map(d => d.product)).size;
            const avgPrice = totalQuantity > 0 ? totalSales / totalQuantity : 0;

            document.getElementById('totalSales').textContent = `¬•${totalSales.toLocaleString()}`;
            document.getElementById('totalQuantity').textContent = `${totalQuantity.toLocaleString()}ÂÄã`;
            document.getElementById('productCount').textContent = uniqueProducts;
            document.getElementById('avgPrice').textContent = `¬•${Math.round(avgPrice).toLocaleString()}`;

            // ÂâçÂπ¥ÊØîË®àÁÆó
            if (totalPrevSales > 0) {
                const salesChange = ((totalSales - totalPrevSales) / totalPrevSales * 100).toFixed(1);
                document.getElementById('salesChange').textContent = `ÂâçÂπ¥ÊØî: ${salesChange >= 0 ? '+' : ''}${salesChange}%`;
                document.getElementById('salesChange').className = `change ${salesChange >= 0 ? 'positive' : 'negative'}`;
                
                document.getElementById('growthRate').textContent = `${salesChange >= 0 ? '+' : ''}${salesChange}%`;
                document.getElementById('growthInfo').className = `change ${salesChange >= 0 ? 'positive' : 'negative'}`;
            }

            if (totalPrevQuantity > 0) {
                const quantityChange = ((totalQuantity - totalPrevQuantity) / totalPrevQuantity * 100).toFixed(1);
                document.getElementById('quantityChange').textContent = `ÂâçÂπ¥ÊØî: ${quantityChange >= 0 ? '+' : ''}${quantityChange}%`;
                document.getElementById('quantityChange').className = `change ${quantityChange >= 0 ? 'positive' : 'negative'}`;
            }

            if (totalPrevSales > 0 && totalPrevQuantity > 0) {
                const prevAvgPrice = totalPrevSales / totalPrevQuantity;
                const priceChange = ((avgPrice - prevAvgPrice) / prevAvgPrice * 100).toFixed(1);
                document.getElementById('priceChange').textContent = `ÂâçÂπ¥ÊØî: ${priceChange >= 0 ? '+' : ''}${priceChange}%`;
                document.getElementById('priceChange').className = `change ${priceChange >= 0 ? 'positive' : 'negative'}`;
            }
        }

        // „Éï„Ç£„É´„Çø„ÉºÁµ±Ë®àÊõ¥Êñ∞
        function updateFilterStats() {
            const stats = document.getElementById('filterStats');
            const totalRecords = filteredData.length;
            const totalSales = filteredData.reduce((sum, d) => sum + d.sales, 0);
            const totalQuantity = filteredData.reduce((sum, d) => sum + d.quantity, 0);
            
            stats.innerHTML = `
                <div><strong>„Éï„Ç£„É´„Çø„ÉºÁµêÊûú</strong></div>
                <div>üìä ${totalRecords}„É¨„Ç≥„Éº„Éâ</div>
                <div>üí∞ ¬•${(totalSales/1000000).toFixed(1)}M</div>
                <div>üì¶ ${(totalQuantity/1000).toFixed(1)}KÂÄã</div>
            `;
        }

        // „ÉÅ„É£„Éº„ÉàÊõ¥Êñ∞
        function updateCharts() {
            updateMonthlySalesChart();
            updateCategoryChart();
            updateYoyComparisonChart();
        }

        // ÊúàÂà•Â£≤‰∏ä„ÉÅ„É£„Éº„Éà
        function updateMonthlySalesChart() {
            const monthlyData = {};
            const monthlyPrevData = {};
            
            filteredData.forEach(d => {
                if (!monthlyData[d.date]) {
                    monthlyData[d.date] = 0;
                    monthlyPrevData[d.date] = 0;
                }
                monthlyData[d.date] += d.sales;
                monthlyPrevData[d.date] += d.prevSales || 0;
            });

            const months = ['2024-09', '2024-10', '2024-11', '2024-12', '2025-01', '2025-02'];
            const monthLabels = ['9Êúà', '10Êúà', '11Êúà', '12Êúà', '1Êúà', '2Êúà'];

            if (charts.monthly) charts.monthly.destroy();
            
            const ctx = document.getElementById('monthlySalesChart').getContext('2d');
            charts.monthly = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: '‰ªäÂπ¥Â£≤‰∏ä',
                        data: months.map(m => monthlyData[m] || 0),
                        borderColor: '#8b1538',
                        backgroundColor: 'rgba(139, 21, 56, 0.1)',
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#8b1538',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 3,
                        pointRadius: 8
                    }, {
                        label: 'ÂâçÂπ¥Â£≤‰∏ä',
                        data: months.map(m => monthlyPrevData[m] || 0),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3498db',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 3,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '¬•' + (value/1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        // „Ç´„ÉÜ„Ç¥„É™Âà•„ÉÅ„É£„Éº„Éà
        function updateCategoryChart() {
            const categoryData = {};
            filteredData.forEach(d => {
                if (!categoryData[d.category]) categoryData[d.category] = 0;
                categoryData[d.category] += d.sales;
            });

            if (charts.category) charts.category.destroy();
            
            const ctx = document.getElementById('categoryChart').getContext('2d');
            charts.category = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        data: Object.values(categoryData),
                        backgroundColor: [
                            '#8b1538',
                            '#3498db',
                            '#2ecc71',
                            '#f39c12',
                            '#9b59b6',
                            '#1abc9c',
                            '#e67e22',
                            '#34495e'
                        ],
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // ÂâçÂπ¥ÂêåÊúüÊØîËºÉ„ÉÅ„É£„Éº„Éà
        function updateYoyComparisonChart() {
            const monthlyData = {};
            const monthlyPrevData = {};
            
            filteredData.forEach(d => {
                if (!monthlyData[d.date]) {
                    monthlyData[d.date] = 0;
                    monthlyPrevData[d.date] = 0;
                }
                monthlyData[d.date] += d.sales;
                monthlyPrevData[d.date] += d.prevSales || 0;
            });

            const months = ['2024-09', '2024-10', '2024-11', '2024-12', '2025-01', '2025-02'];
            const monthLabels = ['9Êúà', '10Êúà', '11Êúà', '12Êúà', '1Êúà', '2Êúà'];
            const differences = months.map(m => (monthlyData[m] || 0) - (monthlyPrevData[m] || 0));

            if (charts.yoy) charts.yoy.destroy();
            
            const ctx = document.getElementById('yoyComparisonChart').getContext('2d');
            charts.yoy = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: 'ÂâçÂπ¥ÊØîÂ¢óÊ∏õÈ°ç',
                        data: differences,
                        backgroundColor: differences.map(d => d >= 0 ? 'rgba(46, 204, 113, 0.8)' : 'rgba(139, 21, 56, 0.8)'),
                        borderColor: differences.map(d => d >= 0 ? '#27ae60' : '#8b1538'),
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '¬•' + (value/1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    }
                }
            });
        }

        // „ÉÜ„Éº„Éñ„É´Êõ¥Êñ∞ÔºàÊ≠£Á¢∫„Å™„Éá„Éº„ÇøÔºâ
        function updateTable() {
            const productSummary = {};
            
            filteredData.forEach(d => {
                if (!productSummary[d.product]) {
                    productSummary[d.product] = {
                        product: d.product,
                        sales: 0,
                        prevSales: 0,
                        quantity: 0,
                        category: d.category
                    };
                }
                productSummary[d.product].sales += d.sales;
                productSummary[d.product].prevSales += d.prevSales || 0;
                productSummary[d.product].quantity += d.quantity;
            });

            const products = Object.values(productSummary)
                .sort((a, b) => b.sales - a.sales)
                .slice(0, 30); // ‰∏ä‰Ωç30ÂïÜÂìÅ

            const tableBody = document.getElementById('productsTable');
            tableBody.innerHTML = '';
            
            products.forEach((product, index) => {
                const avgPrice = product.quantity > 0 ? product.sales / product.quantity : 0;
                const yoyChange = product.prevSales > 0 ? ((product.sales - product.prevSales) / product.prevSales * 100).toFixed(1) : '-';
                const row = tableBody.insertRow();
                
                // ÁâπÂà•„Å™Ëâ≤‰ªò„Åë„Åß‰∏ä‰ΩçÂïÜÂìÅ„ÇíÂº∑Ë™ø
                let rankStyle = '';
                if (index === 0) rankStyle = 'background: linear-gradient(135deg, #f1c40f, #f39c12); color: white; font-weight: bold;';
                else if (index === 1) rankStyle = 'background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white; font-weight: bold;';
                else if (index === 2) rankStyle = 'background: linear-gradient(135deg, #e67e22, #d35400); color: white; font-weight: bold;';
                
                row.innerHTML = `
                    <td style="${rankStyle}"><strong>${index + 1}</strong></td>
                    <td class="product-name" title="${product.product}">${product.product}</td>
                    <td><strong>¬•${product.sales.toLocaleString()}</strong></td>
                    <td>${product.quantity.toLocaleString()}ÂÄã</td>
                    <td>¬•${Math.round(avgPrice).toLocaleString()}</td>
                    <td><span style="background: rgba(139, 21, 56, 0.1); padding: 3px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 500;">${product.category}</span></td>
                    <td class="${yoyChange !== '-' && parseFloat(yoyChange) >= 0 ? 'positive' : 'negative'}">${yoyChange !== '-' ? (yoyChange >= 0 ? '+' : '') + yoyChange + '%' : '-'}</td>
                `;
            });

            // „Ç´„Ç¥„É°„ÅÆÈ†Ü‰Ωç„ÇíÁâπÂà•Ë°®Á§∫
            const kagomeRank = products.findIndex(p => p.product.includes('„Ç´„Ç¥„É°'));
            if (kagomeRank >= 0) {
                console.log(`„Ç´„Ç¥„É°ÂïÜÂìÅ„ÅØ${kagomeRank + 1}‰Ωç„Å´„É©„É≥„ÇØ„Ç§„É≥`);
            } else {
                console.log('„Ç´„Ç¥„É°ÂïÜÂìÅ„ÅØ‰∏ä‰Ωç30‰ΩçÂúèÂ§ñ');
            }
        }

        // „Éï„Ç£„É´„Çø„Éº„É™„Çª„ÉÉ„Éà
        function resetFilters() {
            document.getElementById('dateFilter').value = 'all';
            document.getElementById('minSales').value = '';
            document.getElementById('maxSales').value = '';
            
            document.querySelectorAll('#categoryFilter input[type="checkbox"]').forEach(cb => cb.checked = true);
            document.querySelectorAll('#manufacturerFilter input[type="checkbox"]').forEach(cb => cb.checked = true);
            
            filteredData = [...rawData];
            updateDashboard();
        }

        // ÂàùÊúüÂåñÂÆüË°å
        window.addEventListener('load', loadRealData);
    </script>
</body>
</html>
